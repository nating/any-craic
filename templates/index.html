<!DOCTYPE html>
<html>
  <head>
     <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
     <meta property="og:site_name" content="Room Status">
     <meta property="og:title" content="Room Status">
     <meta property="og:type" content="website">
     <meta name="description" content="The current room status">
     {% if occupied and meeting %}
     <meta property="og:image" content="{{ url_for('static', filename='grimace.png') }}">
     <link rel="shortcut icon" href="{{ url_for('static', filename='grimace.png') }}" type="image/x-icon">
     {% elif occupied %}
     <meta property="og:image" content="{{ url_for('static', filename='smile.png') }}">
     <link rel="shortcut icon" href="{{ url_for('static', filename='smile.png') }}" type="image/x-icon">
     {% else %}
     <meta property="og:image" content="{{ url_for('static', filename='sleepy.png') }}">
     <link rel="shortcut icon" href="{{ url_for('static', filename='sleepy.png') }}" type="image/x-icon">
     {% endif %}
    <title>Room Status</title>
    <link rel='stylesheet' id='bootstrap' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.0/css/bootstrap.min.css' type='text/css' media='all' />
    <meta name="viewport" content="width=device-width, initial-scale=0.6666, maximum-scale=1.0, minimum-scale=0.6666">
  </head>
  {% if occupied and meeting %}
  <body class="p-5 text-center text-white" style="background-color:#ff221e;">
  	<h1 id="heading">Meeting üò¨</h1>
  {% elif occupied %}
  <body class="p-5 text-center text-white" style="background-color:#33ee44;">
  	<h1 id="heading">Occupied üòÅ</h1>
  {% else %}
  <body class="p-5 text-center">
  	<h1 id="heading">Empty üò™</h1>
  {% endif %}
		<h1></h1>
		<h1><br></h1>
		<h1 id="time">(Updated at {{ last_updated }})</h1>
		<h1><br></h1>
		<h1><br></h1>
		<p>nating@tcd.ie</p>
    <script>

        // Pull the status from the server
        function pullStatus(){
          var xmlhttp;
          if (window.XMLHttpRequest) { // code for IE7+, Firefox, Chrome, Opera, Safari
              xmlhttp = new XMLHttpRequest();
          } else { // code for IE6, IE5
              xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
          }
          xmlhttp.onreadystatechange = function() {
              if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                  updateStatus(JSON.parse(xmlhttp.responseText));
                  setTimeout(pullStatus, 5000);
              }
              else if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                  setTimeout(pullStatus, 5000);
              }
          }
          xmlhttp.open("GET", "/status", true);
          xmlhttp.send();
        }

        // Update the status on the page
        function updateStatus(status){
          body = document.getElementsByTagName('body')[0];
          if(status.occupied && status.meeting){
            document.getElementsByTagName('body')[0].className = "p-5 text-center text-white";
            document.getElementsByTagName('body')[0].style.backgroundColor = '#ff221e';
            document.getElementById('heading').innerHTML = 'Meeting üò¨';
          }
          if(status.occupied){
            document.getElementsByTagName('body')[0].className = "p-5 text-center text-white";
            document.getElementsByTagName('body')[0].style.backgroundColor = "##33ee44";
            document.getElementById('heading').innerHTML = 'Occupied üòÅ';
          }
          else{
            document.getElementsByTagName('body')[0].className = "p-5 text-center";
            document.getElementsByTagName('body')[0].style.backgroundColor = '#ffffff';
            document.getElementById('heading').innerHTML = 'Empty üò™';
          }
          document.getElementById('time').innerHTML = '(Updated at '+status.last_updated+')';
        }

        // Initiate AJAX interval
        pullStatus();

    </script>
  </body>
</html>
